service: tradle
stage: dev
region: us-east-1
profile: serverless
emailForNotifications: mark@tradle.io # support@tradle.io
blockchain: ethereum:rinkeby
thresholdBillingAlarm: 1 # $1 / hr
thresholdThrottlingAlarm: 10 # times throttled
thresholdErrorsAlarm: 10 # errors
thresholdInvocationsAlarm: 50 # invocations
thresholdDurationAlarm: 60 # seconds
versionFunctions: false
serverless-offline:
  port: 21012
  mqttPort: 1884

bot_onmessage:
  handler: lib/samplebot/index.onmessage
  memorySize: 1024
  alarms:
    - functionErrors
    - functionThrottles
    - functionInvocations

bot_onsealevent:
  handler: lib/samplebot/index.onseal
  memorySize: 256
  events:
    - stream:
        type: dynamodb
        batchSize: 1
        startingPosition: TRIM_HORIZON
        arn:
          Fn::GetAtt:
            - SealsTable
            - StreamArn
  alarms:
  - functionErrors

bot_onmessagestream:
  handler: lib/samplebot/index.onmessagestream
  memorySize: 256
  events:
    - stream:
        type: dynamodb
        batchSize: 100
        startingPosition: TRIM_HORIZON
        arn:
          Fn::GetAtt:
            - InboxTable
            - StreamArn
    - stream:
        type: dynamodb
        batchSize: 100
        startingPosition: TRIM_HORIZON
        arn:
          Fn::GetAtt:
            - OutboxTable
            - StreamArn
  alarms:
    - functionErrors
    # - functionThrottles
    # - functionInvocations
  # onError:
    # Ref: DeadLetterQueue

bot_graphql:
  # make sure graphql route gets loaded
  handler: lib/samplebot/index.ongraphql
  # handler: lib/lambda/http/default.handler
  memorySize: 512
  events:
    - http:
        path: graphql
        method: get
    - http:
        path: graphql
        method: post
  alarms:
    - functionErrors
    - functionThrottles
    - functionInvocations

# bot-serviced lambda
# generates sample data for browsing with GraphQL
bot_samples:
  handler: lib/samplebot/index.onsamples
  # handler: lib/lambda/http/default.handler
  memorySize: 1024

bot_samples_dev:
  handler: lib/samplebot/index.onsamples
  # handler: lib/lambda/http/default.handler
  memorySize: 1024
  events:
    - http:
        path: samples
        method: post

bot_onfido:
  handler: lib/samplebot/index.handleOnfidoWebhookEvent
  # handler: lib/lambda/http/default.handler
  memorySize: 1024
  events:
    - http:
        path: onfido
        method: post
